<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ†æŒ¯åŠ¨æ¨¡æ‹Ÿç³»ç»Ÿ - å¿«é€Ÿä¿®å¤</title>
    <script src="https://cdn.tailwindcss.com/3.4.0"></script>
    <style>
        .log { padding: 8px; margin: 4px 0; border-radius: 4px; font-family: monospace; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-center mb-6 text-blue-600">
                ğŸ”§ å¤šæ†æŒ¯åŠ¨æ¨¡æ‹Ÿç³»ç»Ÿ - å¿«é€Ÿä¿®å¤å·¥å…·
            </h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- é—®é¢˜è¯Šæ–­ -->
                <div class="border rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">é—®é¢˜è¯Šæ–­</h2>
                    <button onclick="runDiagnostics()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full mb-4">
                        ğŸ” å¼€å§‹è¯Šæ–­
                    </button>
                    <div id="diagnostics-log" class="bg-gray-50 p-3 rounded max-h-64 overflow-y-auto"></div>
                </div>
                
                <!-- å¿«é€Ÿä¿®å¤ -->
                <div class="border rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">å¿«é€Ÿä¿®å¤</h2>
                    <div class="space-y-2">
                        <button onclick="clearCache()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 w-full">
                            ğŸ—‘ï¸ æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
                        </button>
                        <button onclick="reloadModules()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">
                            ğŸ”„ é‡æ–°åŠ è½½æ¨¡å—
                        </button>
                        <button onclick="testCDN()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 w-full">
                            ğŸŒ æµ‹è¯•CDNè¿æ¥
                        </button>
                        <button onclick="switchToBackupCDN()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 w-full">
                            ğŸ”„ åˆ‡æ¢å¤‡ç”¨CDN
                        </button>
                    </div>
                    <div id="fix-log" class="bg-gray-50 p-3 rounded max-h-64 overflow-y-auto mt-4"></div>
                </div>
            </div>
            
            <!-- å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ -->
            <div class="mt-6 border rounded-lg p-4">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="font-semibold text-red-800 mb-2">æ¨¡å—åŠ è½½å¤±è´¥</h3>
                        <ul class="text-sm text-red-700 space-y-1">
                            <li>â€¢ æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>â€¢ åˆ·æ–°é¡µé¢ (Ctrl+F5)</li>
                            <li>â€¢ æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>
                            <li>â€¢ è®¿é—® debug.html æŸ¥çœ‹è¯¦æƒ…</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-2">3Dåœºæ™¯ä¸æ˜¾ç¤º</h3>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>â€¢ æ£€æŸ¥WebGLæ”¯æŒ</li>
                            <li>â€¢ æ›´æ–°æ˜¾å¡é©±åŠ¨</li>
                            <li>â€¢ å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ</li>
                            <li>â€¢ å°è¯•å…¶ä»–æµè§ˆå™¨</li>
                        </ul>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-semibold text-green-800 mb-2">éŸ³é¢‘å¤„ç†é—®é¢˜</h3>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>â€¢ æ£€æŸ¥æ–‡ä»¶æ ¼å¼ (MP3/WAV/MP4)</li>
                            <li>â€¢ ç¡®ä¿æ–‡ä»¶å¤§å° < 10MB</li>
                            <li>â€¢ æ£€æŸ¥Web Audio APIæ”¯æŒ</li>
                            <li>â€¢ å…è®¸æµè§ˆå™¨è®¿é—®éŸ³é¢‘</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h3 class="font-semibold text-yellow-800 mb-2">CDNèµ„æºæ— æ³•åŠ è½½</h3>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>â€¢ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®</li>
                            <li>â€¢ å°è¯•VPNæˆ–ä»£ç†</li>
                            <li>â€¢ ä½¿ç”¨å¤‡ç”¨CDN</li>
                            <li>â€¢ ä¸‹è½½èµ„æºåˆ°æœ¬åœ°</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- å¯¼èˆªé“¾æ¥ -->
            <div class="mt-6 flex justify-center space-x-4">
                <a href="index.html" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    ğŸ  è¿”å›ä¸»é¡µ
                </a>
                <a href="debug.html" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                    ğŸ” è°ƒè¯•é¡µé¢
                </a>
                <a href="test.html" class="bg-purple-500 text-white px-6 py-2 rounded hover:bg-purple-600">
                    ğŸ§ª æµ‹è¯•é¡µé¢
                </a>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info', containerId = 'diagnostics-log') {
            const container = document.getElementById(containerId);
            const logEntry = document.createElement('div');
            logEntry.className = `log ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }

        function clearLog(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function runDiagnostics() {
            clearLog('diagnostics-log');
            log('å¼€å§‹ç³»ç»Ÿè¯Šæ–­...', 'info');
            
            // æ£€æŸ¥WebGLæ”¯æŒ
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    log('âœ“ WebGL æ”¯æŒæ­£å¸¸', 'success');
                } else {
                    log('âœ— WebGL ä¸æ”¯æŒ', 'error');
                }
            } catch (e) {
                log('âœ— WebGL æ£€æŸ¥å¤±è´¥: ' + e.message, 'error');
            }
            
            // æ£€æŸ¥Web Audio API
            try {
                if (window.AudioContext || window.webkitAudioContext) {
                    log('âœ“ Web Audio API æ”¯æŒæ­£å¸¸', 'success');
                } else {
                    log('âœ— Web Audio API ä¸æ”¯æŒ', 'error');
                }
            } catch (e) {
                log('âœ— Web Audio API æ£€æŸ¥å¤±è´¥: ' + e.message, 'error');
            }
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('âœ“ æœ¬åœ°å­˜å‚¨å¯ç”¨', 'success');
            } catch (e) {
                log('âœ— æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨: ' + e.message, 'error');
            }
            
            // æ£€æŸ¥CDNèµ„æº
            await testExternalResource('https://unpkg.com/three@0.158.0/build/three.min.js', 'Three.js');
            await testExternalResource('https://cdn.plot.ly/plotly-2.29.1.min.js', 'Plotly.js');
            await testExternalResource('https://cdn.tailwindcss.com/3.4.0', 'Tailwind CSS');
            
            log('è¯Šæ–­å®Œæˆ', 'info');
        }

        async function testExternalResource(url, name) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) {
                    log(`âœ“ ${name} CDN å¯è®¿é—®`, 'success');
                } else {
                    log(`âœ— ${name} CDN è®¿é—®å¤±è´¥ (${response.status})`, 'error');
                }
            } catch (e) {
                log(`âœ— ${name} CDN è¿æ¥å¤±è´¥: ${e.message}`, 'error');
            }
        }

        function clearCache() {
            log('æ¸…é™¤æµè§ˆå™¨ç¼“å­˜...', 'info', 'fix-log');
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                    log('âœ“ ç¼“å­˜æ¸…é™¤å®Œæˆ', 'success', 'fix-log');
                });
            } else {
                log('âš  æµè§ˆå™¨ä¸æ”¯æŒç¨‹åºåŒ–ç¼“å­˜æ¸…é™¤ï¼Œè¯·æ‰‹åŠ¨æ¸…é™¤ (Ctrl+Shift+Delete)', 'warning', 'fix-log');
            }
        }

        function reloadModules() {
            log('é‡æ–°åŠ è½½é¡µé¢æ¨¡å—...', 'info', 'fix-log');
            setTimeout(() => {
                window.location.reload(true);
            }, 1000);
        }

        async function testCDN() {
            clearLog('fix-log');
            log('æµ‹è¯•CDNè¿æ¥...', 'info', 'fix-log');
            
            const cdnUrls = [
                'https://unpkg.com/three@0.158.0/build/three.min.js',
                'https://cdn.plot.ly/plotly-2.29.1.min.js',
                'https://cdn.tailwindcss.com/3.4.0'
            ];
            
            for (const url of cdnUrls) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    if (response.ok) {
                        log(`âœ“ ${url} - å¯è®¿é—®`, 'success', 'fix-log');
                    } else {
                        log(`âœ— ${url} - å¤±è´¥ (${response.status})`, 'error', 'fix-log');
                    }
                } catch (e) {
                    log(`âœ— ${url} - è¿æ¥å¤±è´¥`, 'error', 'fix-log');
                }
            }
        }

        function switchToBackupCDN() {
            log('åˆ‡æ¢åˆ°å¤‡ç”¨CDN...', 'info', 'fix-log');
            log('âš  æ­¤åŠŸèƒ½éœ€è¦ä¿®æ”¹HTMLæ–‡ä»¶ä¸­çš„CDNé“¾æ¥', 'warning', 'fix-log');
            log('å¤‡ç”¨CDNæ¨è:', 'info', 'fix-log');
            log('Three.js: https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js', 'info', 'fix-log');
            log('Plotly.js: https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.29.1/plotly.min.js', 'info', 'fix-log');
        }
    </script>
</body>
</html> 