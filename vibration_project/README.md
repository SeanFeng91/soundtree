# 多杆件振动模拟系统

一个功能完整的多杆件振动模拟系统，支持不同长度杆件的振动分析、材料特性调节、音频文件激励和波形可视化。

## 🚀 主要特性

### 杆件配置
- **可调节长度**: 20mm - 200mm（以10mm为间隔）
- **数量控制**: 支持1-20根杆件同时模拟
- **直径调节**: 1mm - 20mm（以0.5mm为间隔）
- **长度步长**: 自定义杆件间长度间隔

### 材料特性
- **预设材料**: 钢材、铝材、黄铜、铜材
- **自定义材料**: 可调节弹性模量和密度
- **实时计算**: 根据材料特性自动计算共振频率

### 激励系统
- **正弦波激励**: 20Hz - 2000Hz频率范围
- **扫频激励**: 自动扫描频率范围
- **音频文件激励**: 支持MP4/MP3/WAV文件上传分析
- **声音生成器**: 生成指定频率的测试音频

### 可视化功能
- **3D模拟**: 实时显示杆件振动变形
- **波形图**: 显示时域信号波形
- **频谱图**: 显示频域分析结果
- **共振状态**: 直观显示各杆件的共振状态

## 📁 项目结构

```
vibration_project/
├── index.html              # 主界面文件
├── js/                     # JavaScript模块目录
│   ├── config.js           # 配置文件和常量定义
│   ├── materials.js        # 材料特性模块
│   ├── vibration-calc.js   # 振动计算核心模块
│   ├── audio-processor.js  # 音频处理模块
│   ├── visualization.js    # 可视化图表模块
│   ├── rod-manager.js      # 杆件管理和3D渲染模块
│   ├── main.js            # 主控制模块
│   └── init.js            # 初始化脚本
└── README.md              # 项目说明文档
```

## 🛠️ 技术架构

### 前端框架
- **HTML5**: 现代语义化标记
- **Tailwind CSS**: 现代化响应式UI设计
- **Vanilla JavaScript**: 模块化ES6+代码

### 外部依赖
- **Three.js**: 3D图形渲染和动画
- **Plotly.js**: 交互式图表和数据可视化
- **Web Audio API**: 音频处理和生成

### 模块化设计
每个功能模块独立设计，便于维护和扩展：

1. **MaterialProperties**: 管理材料物理特性
2. **VibrationCalculator**: 振动响应计算核心
3. **AudioProcessor**: 音频文件处理和分析
4. **Visualization**: 图表绘制和数据可视化
5. **RodManager**: 3D场景管理和杆件控制
6. **MainController**: 整体流程控制和UI交互

## 🎯 功能详解

### 1. 杆件振动模拟
- 基于悬臂梁理论的振动响应计算
- 支持多阶模态振动分析
- 实时3D变形显示

### 2. 共振分析
- 自动计算各杆件的自然频率
- 识别共振和接近共振状态
- 提供共振频率对比图表

### 3. 音频激励分析
- FFT频域分析
- 主要频率成分提取
- 音频波形可视化
- 支持音乐文件作为激励源

### 4. 实时参数调节
- 所有参数支持实时调节
- 即时响应和视觉反馈
- 参数值实时显示

## 🚀 使用方法

### 1. 启动系统
1. 在支持WebGL的现代浏览器中打开 `index.html`
2. 等待系统初始化完成
3. 确保网络连接正常（需要加载外部CDN资源）

### 2. 配置杆件
1. 调节"杆件配置"面板中的参数：
   - 杆件数量：选择要模拟的杆件数量
   - 起始长度：设置最短杆件的长度
   - 长度步长：设置相邻杆件的长度差
   - 直径：调节杆件横截面直径

### 3. 选择材料
1. 在"材料特性"面板中：
   - 选择预设材料或选择"自定义"
   - 调节弹性模量和密度（自定义材料时）

### 4. 设置激励
1. 在"激励参数"面板中：
   - 选择激励类型（正弦波/扫频/音频文件）
   - 调节频率、振幅、阻尼比等参数

### 5. 音频文件分析
1. 在"音频处理"面板中：
   - 拖拽或点击上传音频文件
   - 点击"分析频率"进行FFT分析
   - 系统将自动提取主要频率成分

### 6. 声音生成
1. 在"声音生成器"面板中：
   - 设置要生成的频率和时长
   - 点击"生成声音"创建测试音频
   - 点击"播放生成的声音"进行测试

### 7. 运行模拟
1. 点击"播放"按钮开始振动模拟
2. 观察3D场景中杆件的实时变形
3. 查看波形图和频谱图的数据
4. 监控杆件状态列表中的共振情况

## 📊 共振分析

系统会自动计算每根杆件的自然频率，并与激励频率比较：

- **绿色**：正常状态
- **红色**：共振状态（激励频率接近自然频率）
- **橙色**：接近共振状态
- **灰色**：非活动状态

点击"计算共振分析"按钮可查看详细的共振频率对比图表。

## 🎵 音频激励模式

上传音频文件后，系统将：
1. 解析音频信号
2. 进行FFT频域分析
3. 提取主要频率成分
4. 循环使用这些频率作为激励
5. 观察不同频率下的杆件响应

## ⚙️ 系统要求

### 浏览器支持
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

### 必需特性
- WebGL支持
- Web Audio API
- ES6+ JavaScript
- File API
- Canvas API

## 🔧 开发和扩展

### 添加新材料
在 `js/materials.js` 中的 `MaterialProperties` 类中添加新材料定义。

### 修改振动计算
在 `js/vibration-calc.js` 中的 `VibrationCalculator` 类中修改计算公式。

### 自定义可视化
在 `js/visualization.js` 中的 `Visualization` 类中添加新的图表类型。

### 扩展音频处理
在 `js/audio-processor.js` 中的 `AudioProcessor` 类中添加新的音频分析功能。

## 🐛 故障排除

### 常见问题

1. **系统无法启动 / 模块加载失败**
   - 打开浏览器开发者工具(F12)查看控制台错误信息
   - 检查网络连接，确保CDN资源可以正常加载
   - 尝试访问 `debug.html` 页面查看详细的模块加载状态
   - 如果仍有问题，请确保所有JavaScript文件都在正确的路径下
   - 尝试刷新页面或清除浏览器缓存

2. **3D场景不显示**
   - 检查WebGL支持：访问 https://get.webgl.org/ 测试WebGL
   - 更新显卡驱动程序
   - 尝试其他现代浏览器(Chrome、Firefox、Edge)
   - 检查浏览器是否启用了硬件加速

3. **音频文件无法处理**
   - 检查文件格式（支持MP3、MP4、WAV）
   - 确保文件大小合理（建议小于10MB）
   - 检查文件是否损坏
   - 确保浏览器支持Web Audio API

4. **图表不显示**
   - 检查Plotly.js是否正确加载
   - 查看浏览器控制台错误
   - 确保网络连接稳定
   - 检查容器元素是否存在

5. **CDN资源加载问题**
   - 如果CDN访问有问题，可以下载相关库文件到本地
   - 检查防火墙或网络代理设置
   - 尝试使用其他CDN源

### 调试工具

项目包含一个调试页面 `debug.html`，可以帮助诊断加载问题：

```bash
# 启动本地服务器后访问
http://localhost:8000/debug.html
```

该页面会显示：
- 外部库加载状态
- 各个模块的加载情况
- 详细的错误信息

### 版本兼容性

- **Three.js**: v0.158.0
- **Plotly.js**: v2.29.1  
- **Tailwind CSS**: v3.4.0

如果遇到版本兼容性问题，请检查这些库的版本是否正确。

## 📄 许可证

本项目采用 MIT 许可证，详情请参阅 LICENSE 文件。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📞 联系

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件说明问题

---

**享受振动模拟的乐趣！** 🎵🔧📈 