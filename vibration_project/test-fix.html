<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤æµ‹è¯• - å¤šæ†æŒ¯åŠ¨æ¨¡æ‹Ÿ</title>
    <link rel="stylesheet" href="css/local-styles.css">
    <style>
        .test-log {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .step {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 0.25rem;
        }
        .step.success { background: #d4edda; color: #155724; }
        .step.error { background: #f8d7da; color: #721c24; }
        .step.info { background: #d1ecf1; color: #0c5460; }
        .step.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-xl font-bold mb-4">ä¿®å¤æµ‹è¯•é¡µé¢</h1>
        <p class="mb-4">æµ‹è¯•ä¿®å¤åçš„æ¨¡å—åŠ è½½å’Œåˆå§‹åŒ–æµç¨‹</p>
        
        <div class="test-log" id="test-log">
            <div class="step info">å¼€å§‹æµ‹è¯•...</div>
        </div>
        
        <div class="flex gap-2 mt-4">
            <button id="start-test" class="btn btn-primary">å¼€å§‹æµ‹è¯•</button>
            <button onclick="location.reload()" class="btn btn-secondary">é‡æ–°æµ‹è¯•</button>
            <a href="index.html" class="btn btn-success">è¿”å›ä¸»é¡µ</a>
        </div>
        
        <!-- éšè—çš„3Då®¹å™¨ç”¨äºæµ‹è¯• -->
        <div id="threejs-container" style="width: 1px; height: 1px; position: absolute; left: -9999px;"></div>
    </div>

    <!-- å¤–éƒ¨åº“åŠ è½½ -->
    <script>
        // THREE.js åŠ è½½å‡½æ•°
        function loadThreeJS() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
                script.onload = () => resolve();
                script.onerror = () => {
                    log('å°è¯•å¤‡ç”¨CDN...', 'warning');
                    const backupScript = document.createElement('script');
                    backupScript.src = 'https://unpkg.com/three@0.158.0/build/three.min.js';
                    backupScript.onload = () => resolve();
                    backupScript.onerror = () => reject();
                    document.head.appendChild(backupScript);
                };
                document.head.appendChild(script);
            });
        }
        
        // Plotly.js åŠ è½½å‡½æ•°  
        function loadPlotly() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.plot.ly/plotly-2.29.1.min.js';
                script.onload = () => resolve();
                script.onerror = () => {
                    log('å°è¯•å¤‡ç”¨CDN...', 'warning');
                    const backupScript = document.createElement('script');
                    backupScript.src = 'https://unpkg.com/plotly.js@2.29.1/dist/plotly.min.js';
                    backupScript.onload = () => resolve();
                    backupScript.onerror = () => reject();
                    document.head.appendChild(backupScript);
                };
                document.head.appendChild(script);
            });
        }
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('test-log');
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }
        
        async function runTest() {
            const startBtn = document.getElementById('start-test');
            startBtn.disabled = true;
            startBtn.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                // 1. æµ‹è¯•å¤–éƒ¨åº“åŠ è½½
                log('å¼€å§‹åŠ è½½å¤–éƒ¨åº“...', 'info');
                
                await loadThreeJS();
                log('âœ“ THREE.js åŠ è½½æˆåŠŸ', 'success');
                
                await loadPlotly();
                log('âœ“ Plotly.js åŠ è½½æˆåŠŸ', 'success');
                
                // 2. åŠ è½½æœ¬åœ°æ¨¡å—
                log('å¼€å§‹åŠ è½½æœ¬åœ°æ¨¡å—...', 'info');
                
                const scripts = [
                    'js/materials.js',
                    'js/vibration-calc.js', 
                    'js/audio-processor.js',
                    'js/visualization.js',
                    'js/rod-manager.js',
                    'js/main.js'
                ];
                
                for (const scriptSrc of scripts) {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = scriptSrc;
                        script.onload = () => {
                            log(`âœ“ ${scriptSrc} åŠ è½½æˆåŠŸ`, 'success');
                            resolve();
                        };
                        script.onerror = () => {
                            log(`âœ— ${scriptSrc} åŠ è½½å¤±è´¥`, 'error');
                            reject();
                        };
                        document.head.appendChild(script);
                    });
                }
                
                // 3. æµ‹è¯•ç±»æ˜¯å¦å¯ç”¨
                log('æ£€æŸ¥ç±»å®šä¹‰...', 'info');
                const classes = ['MaterialProperties', 'VibrationCalculator', 'AudioProcessor', 'Visualization', 'RodManager', 'MainController'];
                
                for (const className of classes) {
                    if (typeof window[className] !== 'undefined') {
                        log(`âœ“ ${className} ç±»å®šä¹‰æ­£å¸¸`, 'success');
                    } else {
                        log(`âœ— ${className} ç±»æœªæ‰¾åˆ°`, 'error');
                    }
                }
                
                // 4. æµ‹è¯•ä¸»æ§åˆ¶å™¨åˆå§‹åŒ–
                log('æµ‹è¯•ä¸»æ§åˆ¶å™¨åˆå§‹åŒ–...', 'info');
                
                const controller = new MainController();
                await controller.init();
                log('âœ“ ä¸»æ§åˆ¶å™¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                log(`âœ— æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            } finally {
                startBtn.disabled = false;
                startBtn.textContent = 'å¼€å§‹æµ‹è¯•';
            }
        }
        
        document.getElementById('start-test').addEventListener('click', runTest);
    </script>
</body>
</html> 